# 8.14学习笔记  
## 一.NVIC（嵌套向量中断器）  
### 1.核心功能：  
控制中断的优先级，响应时间  
管理多个中断的请求嵌套和处理逻辑  
### 2.中断的优先级机制  
#### 优先级划分  
通过配置中断的优先级，将优先级分为抢占优先级和响应优先级  
#### 中断优先级嵌套规则  
高抢占优先级的中断可打断低抢占优先级中断的执行  
抢占优先级相同时，高子优先级中断优先响应  
抢占优先级相同时，低子优先级中断执行中，高子优先级中断需等待其结束  
#### 特殊中断  
Reset，NMI，Hard Fault优先级为负数，高于普通中断，且优先级不可配置。  
#### 优先级数值含义  
数字越低，优先级越高  
### 3.函数  
`HAL_NVIC_SetPriority();`设置中断优先级  
参数：`IRQn`：外部中断号；`PreemptPriority`：抢占优先级（0-15，值越低优先级越高）；`SubPriority`：子优先级（0-15，值越低优先级越高）  
`HAL_NVIC_EnableIRQ();`使能NVIC的特定中断  
参数：`IRQn`：外部中断号（需先通过`NVIC_PriorityGroupConfig`配置优先级分组）  
### 4.中断特性  
异步性：可在主程序任意位置被触发  
硬件驱动：由外设硬件检测事件并发出中断请求  
自动现场管理：进入中断时内核自动保存部分寄存器，结束后自动恢复并返回断点继续执行  
## 二.TIM定时器  
### 1.定时器类型  
|类型|包含定时器|位宽|  
|:--------:|:--------:|:--------:|  
|高级控制定时器|TIM1、TIM8|16位|  
|通用定时器|TIM2、TIM3、TIM4、TIM5|TIM2/5为32位，其余为16位|  
|基本定时器|TIM6、TIM7|16位|  
|专用定时器|SysTick（内核）|24位|  
### 2.核心寄存器  
预分频器寄存器（TIMx_PSC）：设置定时器分频，如将 168MHz 主频分频为 84MHz、42MHz 等。  
计数器寄存器（TIMx_CNT）：计数单元，计数频率基于分频后频率（如分频后 100MHz，计数 1 次为 10ns）。  
自动重载寄存器（TIMx_ARR）：计数器最大计数值，计数到该值后复位（递增模式下从 0 重新开始）。  
### 3.计数模式  
向上计数模式：从 0 计数到 TIMx_ARR，复位后重新开始，产生溢出事件。  
向下计数模式：从 TIMx_ARR 计数到 0，复位后重新开始，产生下溢事件。  
中央对齐模式：从 0 计数到 TIMx_ARR-1（溢出），再向下计数到 1（溢出），循环往复。  
### 4.通用定时器通道功能  
4 个独立通道（TIMx_CH1~4）支持：  
输入捕获（如测量方波周期）  
输出比较  
PWM 生成（边缘或中间对齐模式）  
单脉冲模式输出  
## 三.TIM-PWM（脉冲宽度调剂）  
### 1.基本原理  
通过改变脉冲信号高电平占比控制平均输出电压/功率  
### 2.关键函数  
`HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_1);`：启动定时器TIM3 的通道 1 PWM 输出。